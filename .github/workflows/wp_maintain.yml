name: wp_maintain_all

on:
  workflow_dispatch:
    inputs:
      per_status_limit:
        description: "How many posts per status (publish/future) to process"
        required: true
        default: "30"
      dry_run:
        description: "1 = do not update WP, just print what would happen"
        required: true
        default: "0"

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: |
          pip install requests

      - name: Run maintain (publish + future)
        env:
          WP_BASE: ${{ secrets.WP_BASE }}
          WP_USER: ${{ secrets.WP_USER }}
          WP_PASS: ${{ secrets.WP_PASS }}

          FEATURED_MEDIA_ID: "332"
          FORCE_FEATURED: "1"

          TARGET_STATUSES: "publish,future"
          PER_STATUS_LIMIT: ${{ github.event.inputs.per_status_limit }}

          # 금액/월요금 제거는 스크립트 기본 포함

          # 이미지 3장 (없으면 생성/업로드해서 삽입)
          ADD_IMAGES: "1"
          UPLOAD_IMAGES: "1"

          # picsum(기본) / unsplash(키 있으면)
          IMAGE_SOURCE: "picsum"
          UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}

          DRY_RUN: ${{ github.event.inputs.dry_run }}
        run: |
          python scripts/wp_maintain_all.py
